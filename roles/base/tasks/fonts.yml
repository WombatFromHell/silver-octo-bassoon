---
- name: Copy fonts and refresh user font cache
  tags: [extra, fonts]
  block:
    - name: Ensure .fonts directory exists
      ansible.builtin.file:
        path: "{{ home_dir }}/.fonts"
        state: directory
        mode: "0755"

    - name: Extract fonts archive to .fonts directory
      ansible.builtin.unarchive:
        src: "{{ playbook_dir }}/files/support/fonts.tar.gz"
        dest: "{{ home_dir }}/.fonts"
        remote_src: false
        creates: "{{ home_dir }}/.fonts/.fonts-extracted"
      notify: refresh_user_font_cache

    - name: Create marker file after extraction
      ansible.builtin.file:
        path: "{{ home_dir }}/.fonts/.fonts-extracted"
        state: touch
        mode: "0644"
      # when: not ansible_check_mode
      check_mode: false
